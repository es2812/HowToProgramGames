<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
    </head>
    <body>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <script>
            var canvas, canvasContext;
            var mouseX;
            var mouseY; 

            var ballX = 75;
            var ballSpeedX = 5;
            var ballY = 75;
            var ballSpeedY = 7;

            const PADDLE_WIDTH = 100;
            const PADDLE_THICKNESS = 10;
            const PADDLE_DIST_FROM_EDGE = 60;
            
            var paddleX = 400;
            
            const BRICK_W = 80;
            const BRICK_H = 20;
            const BRICK_COLS = 10;
            const BRICK_GAP = 2;
            const BRICK_ROWS = 14;

            var brickGrid = new Array(BRICK_COLS*BRICK_ROWS);

            window.onload = function() {
                canvas = document.getElementById('gameCanvas');
                canvasContext = canvas.getContext('2d');
            
                
                var framesPerSecond = 30;
                setInterval(updateAll, 1000/framesPerSecond);           
                
                canvas.addEventListener('mousemove', updateMousePos);
                
                brickReset();
                // ballReset();
            }
            
            function brickReset() {
            for(var col=0;col<BRICK_COLS;col++){
                for(var row=0;row<BRICK_ROWS;row++){
                    if(Math.random() < 0.5){
                        brickGrid[rowColToArrayIndex(col,row)] = true;
                        } else {
                            brickGrid[rowColToArrayIndex(col,row)] = false;
                        } //end of else (rand check)
                    } //end of for each brick row
                } //end of for each brick col
            } //end of brickReset function
            function updateMousePos(evt) {
                var rect = canvas.getBoundingClientRect();
                var root = document.documentElement;

                mouseX = evt.clientX - rect.left - root.scrollLeft;
                mouseY = evt.clientY - rect.top - root.scrollTop;

                paddleX = mouseX-PADDLE_WIDTH/2;
            }
            function ballReset() {
                ballX = canvas.width/2;
                ballY = canvas.height/2;

                ballSpeedX = 5;
                ballSpeedY = 7;
            }
            function updateAll() {
                moveAll();
                drawAll();
            }
            function moveAll(){
                ballX += ballSpeedX;
                ballY += ballSpeedY;
                
                if(ballX > canvas.width | ballX < 0){
                    ballSpeedX *= -1;
                }
                if(ballY > canvas.height){
                    ballReset();
                }else if(ballY < 0){
                    ballSpeedY *= -1;
                }
                
                var paddleTopEdge = canvas.height-PADDLE_DIST_FROM_EDGE;
                var paddleBottomEdge = paddleTopEdge+PADDLE_THICKNESS;
                var paddleLeftEdge = paddleX;
                var paddleRightEdge = paddleX+PADDLE_WIDTH;
                
                if( ballY > paddleTopEdge &&  //below top paddle
                    ballY < paddleBottomEdge && //above bottom paddle
                    ballX > paddleLeftEdge && //right of paddle left edge
                    ballX < paddleRightEdge ){ //left of paddle right edge
                    
                        ballSpeedY *= -1;
                        
                        var centerOfPaddleX = paddleX + PADDLE_WIDTH/2;
                        var ballDistFromPaddleCenterX = ballX - centerOfPaddleX;
                        ballSpeedX = ballDistFromPaddleCenterX*0.35;
                }

                var ballBrickCol = Math.floor(ballX / BRICK_W);
                var ballBrickRow = Math.floor(ballY / BRICK_H);
                var brickIndexUnderBall = rowColToArrayIndex(ballBrickCol,ballBrickRow);
                
                //colorText(mouseBrickCol+","+mouseBrickRow+":"+brickIndexUnderMouse, mouseX+10, mouseY+10, 'yellow'); //show mouse position for debugging

                if(ballBrickCol >= 0 && ballBrickCol < BRICK_COLS &&
                   ballBrickRow >= 0 && ballBrickRow < BRICK_ROWS &&
                   brickGrid[brickIndexUnderBall]) {
                        brickGrid[brickIndexUnderBall] = false;
                        ballSpeedY *= -1;
                }


            }
            function drawAll(){
                colorRect(0,0, canvas.width, canvas.height,'black'); //clear screen
                colorCircle(ballX, ballY, 10, 'white'); //draw ball
                colorRect(paddleX, canvas.height-PADDLE_DIST_FROM_EDGE, PADDLE_WIDTH, PADDLE_THICKNESS, 'white'); //draw paddle
                
                drawBricks();
            }
            function rowColToArrayIndex(col, row){
                return col+row*BRICK_COLS;
            }
            function drawBricks() {
                for(var row=0;row<BRICK_ROWS; row++){
                    for(var col=0;col<BRICK_COLS;col++){
                        if(brickGrid[rowColToArrayIndex(col,row)]){
                            colorRect(BRICK_W*col, BRICK_H*row, BRICK_W-BRICK_GAP, BRICK_H-BRICK_GAP, 'blue');
                        }//end of is this brick here
                    }//end of for loop to draw rows
                }//end of for loop to draw bricks
            }//end of drawBricks
            function colorRect(topLeftX, topLeftY, boxWidth, boxHeight, fillColor){
                canvasContext.fillStyle = fillColor;
                canvasContext.fillRect(topLeftX, topLeftY, boxWidth, boxHeight);
            }
            function colorCircle(centerX, centerY, radius, fillColor){
                canvasContext.fillStyle = fillColor;
                canvasContext.beginPath();
                canvasContext.arc(centerX, centerY, radius, 0, Math.PI*2, true);
                canvasContext.fill();
            }
            function colorText(showWords, textX, textY, fillColor){
                canvasContext.fillStyle = fillColor;
                canvasContext.fillText(showWords, textX, textY);
            }
        </script>
    </body>
    </html>
    
    